# Vacaition

## Development

### Start the application

```bash
docker compose up --build
```

### Stop application

```bash
docker compose down -v
```

### Generate openAPI docs for given service

1. Install swag from github.com/swaggo/swag/cmd/swag

```bash
go install github.com/swaggo/swag/cmd/swag@latest
```

2. Generate docs

```bash
$GOPATH/bin/swag init -o ./docs/<serviceName> -g services/userService/main.go
```

3. Include generated file in swagger handler (You may adapt the oauth authorization url as it cannot be changed dynamically)

```go
import (
	_ "backend/docs/userService" // docs is generated by Swag CLI, you have to import it.
	"backend/pkg/database"
	"fmt"
	"net/http"

	"github.com/go-chi/chi/v5"
	"github.com/spf13/viper"
	httpSwagger "github.com/swaggo/http-swagger/v2"
)

func RegisterRoutes(router *chi.Mux, db *database.DB) {

	router.Get("/api/swagger/*", httpSwagger.Handler(
		httpSwagger.URL(fmt.Sprintf("http://%s/api/swagger/doc.json", viper.GetString("URL")))), //The url pointing to API definition
	)

    //...
}
```

### Testing

In a given service folder, e.g. user service, run the following command to conduct all unit tests and to save the coverage:

```bash
go test -coverpkg=./... --cover ./... -coverprofile ./cover.out -v
```

The coverage results can than be analyzed using the html template provided by golang:

```bash
cd services/userService

go tool cover -html=cover.out # This opens a browser tab with the coverage results
```
